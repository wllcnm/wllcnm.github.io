<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2022/12/30/%E5%AF%B9%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E5%8A%A0%E5%AF%86,%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84AOP%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0/"/>
      <url>/2022/12/30/%E5%AF%B9%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E5%8A%A0%E5%AF%86,%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84AOP%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="对接口参数加密-基于注解的AOP编程实现"><a href="#对接口参数加密-基于注解的AOP编程实现" class="headerlink" title="对接口参数加密,基于注解的AOP编程实现"></a>对接口参数加密,基于注解的AOP编程实现</h1><p>  最近看了个关于接口验证的demo,用到了AOP编程,业务需求是对接口进行参数加密,在调用接口时,前端必须将参数进行加密,然受调用接口时必须将加密后的参数一并上传,后端拿到参数后必须对参数进行加密,之后拿到这段加密后的密钥与前端进行对比,然后判断参数是否被篡改.</p><h2 id="1-实现过程"><a href="#1-实现过程" class="headerlink" title="1.实现过程"></a>1.实现过程</h2><p>先对发送过来的请求头定义</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 请求头</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SIGN_HEADER</span> <span class="operator">=</span> <span class="string">&quot;X-SIGN&quot;</span>;</span><br></pre></td></tr></table></figure><p>定义切入点,因为使用注解标识需要使用参数加密的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 切入点</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(@com.example.springbootdemo.annotation.Signature * *(..))&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">verifySignPointCut</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// nothing</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>定义@Before注解下的方法,该方法主要通过对接受的参数判断有没有,以及进行加密</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   * 在切入点之前执行</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">    <span class="meta">@Before(&quot;verifySignPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">verify</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line">        <span class="type">String</span> <span class="variable">sign</span> <span class="operator">=</span> request.getHeader(SIGN_HEADER);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断请求头中有没有SIGN_HEADER参数,没有直接抛出异常</span></span><br><span class="line">        <span class="keyword">if</span> (CharSequenceUtil.isBlank(sign)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;no signature in header: &quot;</span> + SIGN_HEADER);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用generatedSignature(HttpRequest request)方法校验签名是否正确</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//得到参数签名,将生成的参数签名与请求头的参数进行比较,对比成功就通过,否则抛出异常</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">generatedSign</span> <span class="operator">=</span> generatedSignature(request);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!sign.equals(generatedSign)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;invalid signature&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;invalid signat定义ure&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>定义generatedSignature方法,该方法用于获取requestBody中的参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">generatedSignature</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="comment">// @RequestBody</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">bodyParam</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">if</span> (request <span class="keyword">instanceof</span> ContentCachingRequestWrapper) &#123;</span><br><span class="line">           bodyParam = <span class="keyword">new</span> <span class="title class_">String</span>(((ContentCachingRequestWrapper) request).getContentAsByteArray(), StandardCharsets.UTF_8);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// @RequestParam</span></span><br><span class="line">       Map&lt;String, String[]&gt; requestParameterMap = request.getParameterMap();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// @PathVariable</span></span><br><span class="line">       String[] paths = <span class="literal">null</span>;</span><br><span class="line">       <span class="type">ServletWebRequest</span> <span class="variable">webRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, <span class="literal">null</span>);</span><br><span class="line">       Map&lt;String, String&gt; uriTemplateVars = (Map&lt;String, String&gt;) webRequest.getAttribute(</span><br><span class="line">               HandlerMapping.URI_TEMPLATE_VARIABLES_ATTRIBUTE, RequestAttributes.SCOPE_REQUEST);</span><br><span class="line">       <span class="keyword">if</span> (!CollectionUtils.isEmpty(uriTemplateVars)) &#123;</span><br><span class="line">           paths = uriTemplateVars.values().toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> SignUtil.sign(bodyParam, requestParameterMap, paths);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>SignUtil.sign()方法主要用于对参数进行加密用到了sha256加密,关于该加密算法详见百度</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SignUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_SECRET</span> <span class="operator">=</span> <span class="string">&quot;1qaz@WSX#$%&amp;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">sign</span><span class="params">(String body, Map&lt;String, String[]&gt; params, String[] paths)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">if</span> (CharSequenceUtil.isNotBlank(body)) &#123;</span><br><span class="line">            sb.append(body).append(<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(params)) &#123;</span><br><span class="line">            params.entrySet()</span><br><span class="line">                    .stream()</span><br><span class="line">                    .sorted(Map.Entry.comparingByKey())</span><br><span class="line">                    .forEach(paramEntry -&gt; &#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">paramValue</span> <span class="operator">=</span> String.join(<span class="string">&quot;,&quot;</span>, Arrays.stream(paramEntry.getValue()).sorted().toArray(String[]::<span class="keyword">new</span>));</span><br><span class="line">                        sb.append(paramEntry.getKey()).append(<span class="string">&quot;=&quot;</span>).append(paramValue).append(<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ArrayUtil.isNotEmpty(paths)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">pathValues</span> <span class="operator">=</span> String.join(<span class="string">&quot;,&quot;</span>, Arrays.stream(paths).sorted().toArray(String[]::<span class="keyword">new</span>));</span><br><span class="line">            sb.append(pathValues);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> SecureUtil.sha256(String.join(<span class="string">&quot;#&quot;</span>, DEFAULT_SECRET, sb.toString()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-如何使用"><a href="#2-如何使用" class="headerlink" title="2.如何使用"></a>2.如何使用</h2><p>在需要参数校验的接口上加上注解</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://oss.lw123.top/%E6%96%87%E7%AB%A0/image-20221230170755670.png" alt="image-20221230170755670"></p><p>在apipost上测试,加上加密后的字符串在请求头</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://oss.lw123.top/%E6%96%87%E7%AB%A0/image-20221230170904278.png" alt="image-20221230170904278"></p><p>如果请求头密钥不匹配,则会抛出异常</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://oss.lw123.top/%E6%96%87%E7%AB%A0/image-20221230171559520.png" alt="image-20221230171559520"></p><p>  <strong>通过该案例,我也复习了AOP编程,因为之前学习AOP的时候只跟着做了声明式事务,而关于AOP的其他方面了解不够升入,借这个案例复习了一遍AOP</strong>,<strong>over</strong></p><p>原作者:<a href="https://pdai.tech/md/spring/springboot/springboot-x-interface-jiami.html">https://pdai.tech/md/spring/springboot/springboot-x-interface-jiami.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>在spring boot中使用github图床和七牛云图床</title>
      <link href="/2022/12/05/%E5%9C%A8spring%20boot%E4%B8%AD%E4%BD%BF%E7%94%A8github%E5%9B%BE%E5%BA%8A%E5%92%8C%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8A/"/>
      <url>/2022/12/05/%E5%9C%A8spring%20boot%E4%B8%AD%E4%BD%BF%E7%94%A8github%E5%9B%BE%E5%BA%8A%E5%92%8C%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8A/</url>
      
        <content type="html"><![CDATA[<h1 id="在spring-boot中使用github图床和七牛云图床"><a href="#在spring-boot中使用github图床和七牛云图床" class="headerlink" title="在spring boot中使用github图床和七牛云图床"></a>在spring boot中使用github图床和七牛云图床</h1><p>​        作为一名后端,我们会无时无刻的接受前端发送过来的数据,这些数据大部分是文本请求,但前后端也会有许多文件交互,用户在上传一张图片或视频时,我们通常不会把她存放在<strong>MySQL</strong>数据库里,因为这样会极大的降低数据库的性能,最好的解决办法就是将图片存放在例如GitHub这样的开源托管网站,或者像<strong>阿里云</strong>或者<strong>七牛云</strong>这样的OSS服务器.</p><h2 id="1-在spring-boot中使用github图床"><a href="#1-在spring-boot中使用github图床" class="headerlink" title="1.在spring boot中使用github图床"></a>1.在spring boot中使用github图床</h2><p>我们打开我们的后端项目</p><p>先设置上传所需的必要参数,设置一个抽象类,里面有静态名称,方便以后直接引用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Param</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String branch=<span class="string">&quot;main&quot;</span>;<span class="comment">//设置分支,这里填写main</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String name=<span class="string">&quot;awei&quot;</span>;<span class="comment">//你的姓名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String email=<span class="string">&quot;xxxx@qq.com&quot;</span>;<span class="comment">//你的邮箱</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String OWNER=<span class="string">&quot;wllcnm&quot;</span>;<span class="comment">//GITHUB用户名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String REPO=<span class="string">&quot;images&quot;</span>;<span class="comment">//仓库名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PATH=<span class="string">&quot;img/&quot;</span>;<span class="comment">//想要存放的路径,例如img/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String Authorization=<span class="string">&quot;token &quot;</span>+<span class="string">&quot;填写你自己的密钥&quot;</span>;<span class="comment">//注意token后跟有空格</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>找到我们写的controller方法,前端上传一张图片给后端,我们返回这张图片的地址给前端</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;上传文件&quot;)</span></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">uploading</span><span class="params">(<span class="meta">@RequestParam(&quot;Image&quot;)</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="comment">// 把上传文件内容Base64</span></span><br><span class="line">       <span class="comment">//String fileBase64 = encryptToBase64(filepath);</span></span><br><span class="line">       <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LinfengException</span>(<span class="string">&quot;上传文件不能为空&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">byte</span>[] bytes = file.getBytes();</span><br><span class="line">       <span class="type">String</span> <span class="variable">fileBase64</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Objects.requireNonNull(Base64.encodeBase64(bytes)));</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取文件后缀</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">       <span class="comment">// 重置文件名防止重复</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>) + originalFilename;</span><br><span class="line">       <span class="type">JSONObject</span> <span class="variable">param</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">       param.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;这是一张图片&quot;</span>);<span class="comment">// 提交描述</span></span><br><span class="line">       param.put(<span class="string">&quot;content&quot;</span>, fileBase64);<span class="comment">// Base64过的文件</span></span><br><span class="line">       param.put(<span class="string">&quot;branch&quot;</span>, Param.branch);<span class="comment">// 上传到仓库的分支，以前是master;2020.10.01开始就变成了main了</span></span><br><span class="line">       <span class="type">JSONObject</span> <span class="variable">committer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">       committer.put(<span class="string">&quot;name&quot;</span>, Param.name); <span class="comment">// 提交的作者或提交者的姓名</span></span><br><span class="line">       committer.put(<span class="string">&quot;email&quot;</span>, Param.email);<span class="comment">// 提交的作者或提交者的电子邮件</span></span><br><span class="line">       param.put(<span class="string">&quot;committer&quot;</span>, committer);</span><br><span class="line">       param.put(<span class="string">&quot;sha&quot;</span>, <span class="string">&quot;&quot;</span>);<span class="comment">// 添加的时候没有参数也要写&quot;&quot;</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://api.github.com/repos/OWNER/REPO/contents/PATH&quot;</span>;</span><br><span class="line">       url = url.replace(<span class="string">&quot;OWNER&quot;</span>, Param.OWNER)<span class="comment">// 存储库的帐户所有者。名称不区分大小写</span></span><br><span class="line">               .replace(<span class="string">&quot;REPO&quot;</span>, Param.REPO)<span class="comment">// 仓库名称</span></span><br><span class="line">               .replace(<span class="string">&quot;PATH&quot;</span>, Param.PATH);<span class="comment">// 存储仓库里面的路径</span></span><br><span class="line">       url = url + fileName;</span><br><span class="line"></span><br><span class="line">       <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> HttpRequest.put(url)</span><br><span class="line">               .header(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;application/vnd.github+json&quot;</span>)</span><br><span class="line">               .header(<span class="string">&quot;Authorization&quot;</span>, Param.Authorization).body(param.toString()).execute();</span><br><span class="line">       log.info(<span class="string">&quot;响应结果：&#123;&#125;&quot;</span>, response.body());</span><br><span class="line">       <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSONObject.parseObject(response.body());</span><br><span class="line">       <span class="comment">// 取出访问地址</span></span><br><span class="line">       <span class="type">JSONObject</span> <span class="variable">content</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;content&quot;</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">download_url</span> <span class="operator">=</span> content.getString(<span class="string">&quot;download_url&quot;</span>);</span><br><span class="line">       log.info(download_url);</span><br><span class="line">       <span class="keyword">return</span> R.ok().put(<span class="string">&quot;result&quot;</span>, download_url);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>这里将图片转为base64格式,压缩了图片的大小,提高了传输效率</p><h2 id="2-在spring-boot中使用七牛云"><a href="#2-在spring-boot中使用七牛云" class="headerlink" title="2.在spring boot中使用七牛云"></a>2.在spring boot中使用七牛云</h2><p>我们打开七牛云</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://oss.lw123.top/img/image-20221205001040409.png" alt="image-20221205001040409"></p><p>复制<strong>AK</strong>和<strong>SK</strong></p><p>图片文件上传的工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.admin.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Region;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QiNiuUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qiniu.accessKey&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span>  String accessKey;      <span class="comment">//公钥</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qiniu.secretKey&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span>  String accessSecretKey;   <span class="comment">//私钥</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qiniu.bucketName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span>  String bucket;   <span class="comment">// 存储空间</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qiniu.imageUrl&#125;&quot;)</span><span class="comment">//# 域名/路径</span></span><br><span class="line">    <span class="keyword">private</span>  String url;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理多文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> multipartFiles</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span>  Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">uploadImages</span><span class="params">(MultipartFile[] multipartFiles)</span> &#123;</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; imageUrls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (MultipartFile file : multipartFiles) &#123;</span><br><span class="line">            imageUrls.add(uploadImageQiniu(file));</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(<span class="string">&quot;imageUrl&quot;</span>, imageUrls);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传图片到七牛云</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> multipartFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  String <span class="title function_">uploadImageQiniu</span><span class="params">(MultipartFile multipartFile)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1、获取文件上传的流</span></span><br><span class="line">            <span class="type">byte</span>[] fileBytes = multipartFile.getBytes();</span><br><span class="line">            <span class="comment">//2、创建日期目录分隔</span></span><br><span class="line">            <span class="type">SimpleDateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy/MM/dd&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">datePath</span> <span class="operator">=</span> dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3、获取文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> multipartFile.getOriginalFilename();</span><br><span class="line">            <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> datePath + <span class="string">&quot;/&quot;</span> + UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>) + suffix;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.构造一个带指定 Region 对象的配置类</span></span><br><span class="line">            <span class="comment">//Region.南(根据自己的对象空间的地址选</span></span><br><span class="line">            <span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Region.huanan());</span><br><span class="line">            <span class="comment">//后来换了稳定的新加坡的空间并且绑定了个人域名没有做https的配置这时候要配置这个选项</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             *域名不支持https访问会报错ssl验证error</span></span><br><span class="line"><span class="comment">             *cfh.useHttpsDomains=false</span></span><br><span class="line"><span class="comment">             * 关闭实列即可 默认是开启的</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            cfg.useHttpsDomains = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">UploadManager</span> <span class="variable">uploadManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadManager</span>(cfg);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5.获取七牛云提供的 token</span></span><br><span class="line">            <span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, accessSecretKey);</span><br><span class="line">            <span class="type">String</span> <span class="variable">upToken</span> <span class="operator">=</span> auth.uploadToken(bucket);</span><br><span class="line">            uploadManager.put(fileBytes, filename, upToken);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> url + filename;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>AK</strong>和<strong>SK</strong>写在配置文件中<strong>application.yal</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">qiniu:</span></span><br><span class="line">  <span class="comment"># 文件大小用户端和后台管理端 单位M</span></span><br><span class="line">  <span class="attr">max-size:</span> <span class="number">30</span></span><br><span class="line">  <span class="attr">admin-max-size:</span> <span class="number">30</span></span><br><span class="line">  <span class="comment">#AK</span></span><br><span class="line">  <span class="attr">accessKey:</span> </span><br><span class="line">  <span class="comment">#SK</span></span><br><span class="line">  <span class="attr">secretKey:</span> </span><br><span class="line">  <span class="comment">#七牛的仓库名</span></span><br><span class="line">  <span class="attr">bucketName:</span> </span><br><span class="line">  <span class="comment">#图片存放路径</span></span><br><span class="line">  <span class="attr">imageUrl:</span> </span><br></pre></td></tr></table></figure><h3 id="在Typora中使用七牛云"><a href="#在Typora中使用七牛云" class="headerlink" title="在Typora中使用七牛云"></a>在<strong>Typora</strong>中使用七牛云</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://oss.lw123.top/img/image-20221205001602280.png" alt="image-20221205001602280"></p><p>注意设定访问网址这一栏需要加**http://<strong>前缀,如果支持</strong>https://**就加上,否则Typora无法通过外链访问</p><h4 id="Typora设置"><a href="#Typora设置" class="headerlink" title="Typora设置"></a>Typora设置</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://oss.lw123.top/img/image-20221205001837582.png" alt="image-20221205001837582"></p><p>ok,到这就结束了</p>]]></content>
      
      
      <categories>
          
          <category> spring boot </category>
          
          <category> 图床 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> spring </tag>
            
            <tag> spring boot </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo博客中使用矢量图标设置社交媒体图标和网站图标</title>
      <link href="/2022/12/04/hexo%E5%8D%9A%E5%AE%A2%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E6%A0%87%E8%AE%BE%E7%BD%AE%E7%A4%BE%E4%BA%A4%E5%AA%92%E4%BD%93%E5%9B%BE%E6%A0%87%E5%92%8C%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87/"/>
      <url>/2022/12/04/hexo%E5%8D%9A%E5%AE%A2%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E6%A0%87%E8%AE%BE%E7%BD%AE%E7%A4%BE%E4%BA%A4%E5%AA%92%E4%BD%93%E5%9B%BE%E6%A0%87%E5%92%8C%E7%BD%91%E7%AB%99%E5%9B%BE%E6%A0%87/</url>
      
        <content type="html"><![CDATA[<h1 id="hexo博客中使用矢量图标设置社交媒体图标和网站图标"><a href="#hexo博客中使用矢量图标设置社交媒体图标和网站图标" class="headerlink" title="hexo博客中使用矢量图标设置社交媒体图标和网站图标"></a>hexo博客中使用矢量图标设置社交媒体图标和网站图标</h1><h3 id="1-使用标签样式"><a href="#1-使用标签样式" class="headerlink" title="1.使用标签样式"></a>1.使用标签样式</h3><p>在hexo中想要使用矢量图标,首先进入**<a href="https://fontawesome.com/**%E6%90%9C%E7%B4%A2%E8%87%AA%E5%B7%B1%E6%83%B3%E8%A6%81%E7%9A%84%E5%9B%BE%E6%A0%87,%E6%88%91%E4%BB%AC%E9%9A%8F%E6%84%8F%E6%89%BE%E5%88%B0%E4%B8%80%E4%B8%AA%E5%9B%BE%E6%A0%87">https://fontawesome.com/**搜索自己想要的图标,我们随意找到一个图标</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/wllcnm/images/img/image-20221204145554857.png" alt="image-20221204145554857"></p><p>复制图片中的<strong>html</strong>标签中的<strong>class</strong>内容</p><p>打开自己的hexo工程,打开**_config.butterfly.yml**文件,例如我们想要更该社交媒体的图标,我们找到social这一项,最左边的填我们刚刚复制的内容,之后按照 <strong>网址|| 简介</strong>的格式填写</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/wllcnm/images/img/image-20221204150144945.png" alt="image-20221204150144945"></p><p>完成后就可以看到效果了</p><h3 id="2-下载svg文件-在工程中通过绝对路径引用-并设置网站图标"><a href="#2-下载svg文件-在工程中通过绝对路径引用-并设置网站图标" class="headerlink" title="2.下载svg文件,在工程中通过绝对路径引用,并设置网站图标"></a>2.下载svg文件,在工程中通过绝对路径引用,并设置网站图标</h3><p>我们打开阿里的矢量图网站</p><p>[<a href="https://www.iconfont.cn/]">https://www.iconfont.cn/]</a>: </p><p>打开一个图标</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/wllcnm/images/img/image-20221204150755896.png" alt="image-20221204150755896"></p><p>点击下载,将下载的svg文件保存在hexo工程中的source/_post/img/svg文件夹中</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/wllcnm/images/img/image-20221204150922363.png" alt="image-20221204150922363"></p><p>之后我们打开**_config.butterfly.yml**配置文件,找到favicon这一项,没有的可以加上</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/wllcnm/images/img/image-20221204151044472.png" alt="image-20221204151044472"></p><p>最后在控制台输入<strong>hexo s</strong></p><p>打开网站,就可以看到效果了</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/wllcnm/images/img/image-20221204151207212.png" alt="image-20221204151207212"></p>]]></content>
      
      
      <categories>
          
          <category> hexo博客搭建 </category>
          
          <category> font-awesome图标 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> spring </tag>
            
            <tag> spring boot </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的第一篇文章</title>
      <link href="/2022/12/03/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/"/>
      <url>/2022/12/03/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/</url>
      
        <content type="html"><![CDATA[<p>##第一篇文章</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
